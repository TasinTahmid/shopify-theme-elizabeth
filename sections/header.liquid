<link rel="stylesheet" href="{{ 'header.css' | asset_url }}">
{% assign main_menu_linklist = linklists[section.settings.menu].links %}
{% comment %} {{ shop.customer_accounts_enabled }} {% endcomment %}

<div x-data="{ mobileMenuOpen: false, searchBarOpen:false }">
  <div>
    <div class="desktop-nav">
      <!-- STORE NAME / STORE LOGO -->
      <div>
        <h1 class="desktop-store-title">{{ section.settings.mobile_menu_title }}</h1>
      </div>

      <!-- NAVIGATION MENU -->
      <nav class="desktop-nav-links-container">
        {% for link in main_menu_linklist %}
          {% assign link_handle = link.handle | replace: '-', '_' %}
          {% if link.links != blank %}
            <div x-data="{ {{ link_handle }}:false }" class="desktop-nav-links">
              <button
                x-on:click="{{ link_handle }} = !{{ link_handle }}"
                type="button"
                class="flex-icon-button"
              >
                <span>{{ link.title }}</span>
                {% render 'dropdown-icon' %}
              </button>

              <div
                x-show="{{ link_handle }}"
                @click.away="{{ link_handle }} = false"
              >
                <div class="desktop-nav-dropdown">
                  {% for sublink in link.links %}
                    <div class="desktop-nav-dropdown-links-wrapper">
                      <a href="{{ sublink.url }}" class="desktop-nav-dropdown-links">
                        {{ sublink.title }}
                      </a>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% else %}
            <div class="desktop-nav-links">
              <a href="{{ link.url }}" class="desktop-nav-links">{{ link.title }}</a>
            </div>
          {% endif %}
        {% endfor %}
      </nav>

      <!-- CART BUTTON / ACCOUNT LINKS IF ENABLED -->
      <div class="cart-and-user-menu">
        <button
          x-on:click="searchBarOpen = true"
          type="button"
          class="icon-button desktop-nav-links"
        >
          {% render 'search-icon' %}
        </button>
        <a href="{{ routes.cart_url }}" class="desktop-nav-links icon-button">
          {% render 'bag-icon' %}
        </a>

        {% if shop.customer_accounts_enabled %}
          <a href="{{ routes.account_login_url }}" class="desktop-nav-links">Login</a>
          <a href="{{ routes.account_register_url }}" class="desktop-nav-links">Register</a>
        {% endif %}
      </div>

      <!-- Moblie MENU -->
      <div class="mobile-menu-icon">
        <button
          type="button"
          class="icon-button"
          @click="mobileMenuOpen = !mobileMenuOpen"
        >
          {% render 'menu-icon' %}
        </button>
      </div>

      <!-- MOBILE MENU CONTAINER -->
      <div x-show="mobileMenuOpen" class="mobile-side-menu-bar-wrapper">
        <div class="mobile-side-menu-bar">
          <!-- MOBILE MENU HEADER TITLE PLUS CLOSE BUTTON -->
          <div class="mobile-nav-header">
            <div>
              <h1 class="mobile-store-title">{{ section.settings.mobile_menu_title }}</h1>
            </div>
            <div>
              <button @click="mobileMenuOpen = false" type="button" class="icon-button">
                {% render 'close-icon' %}
              </button>
            </div>
          </div>

          <!-- NAVIGATION LINKS FOR MOBILE MENU -->
          <div class="mobile-nav-items-wrapper">
            <nav class="mobile-nav-items">
              {% for link in main_menu_linklist %}
                {% assign link_handle = link.handle | replace: '-', '_' %}
                {% if link.links != blank %}
                  <div x-data="{ {{ link_handle }}:false }">
                    <button
                      @click="{{ link_handle }} = !{{ link_handle }}"
                      type="button"
                      class="flex-icon-button mobile-nav-dropdown"
                    >
                      <div>{{ link.title }}</div>
                      {% render 'dropdown-icon' %}
                    </button>

                    <div x-show="{{ link_handle }}" class="mobile-sublinks-container">
                      {% for sublink in link.links %}
                        <a
                          href="{{ sublink.url }}"
                          class="mobile-nav-links "
                        >
                          <span>{{ sublink.title }}</span>
                        </a>
                      {% endfor %}
                    </div>
                  </div>

                {% else %}
                  <a
                    href="{{ link.url }}"
                    class="mobile-nav-links "
                  >
                    {{ link.title }}
                  </a>
                {% endif %}
              {% endfor %}
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div x-show="searchBarOpen">
    <button type="button" x-on:click="searchBarOpen = false">
      {% render 'close-icon' %}
    </button>
    <div>
      <form action="{{ routes.search_url }}" method="get">
        <div>
          <input
            type="search"
            name="q"
            placeholder="Search"
          >
          <button type="submit">
            {% render 'search-icon' %}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Navigational Bar",
  "settings": [
    {
      "type": "text",
      "id": "mobile_menu_title",
      "label": "Title",
      "default": "Menu",
      "info": "This is title of the mobile menu window"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Header Menu",
      "default": "main-menu"
      // "info": "This is title of the mobile menu window"
    }
  ]
}
{% endschema %}
